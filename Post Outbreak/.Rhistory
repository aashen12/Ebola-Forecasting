true$cases[is.na(true$cases)] <- 0
true <- true %>% mutate(total = cumsum(cases))
last_date <- true$date[length(true$date)]
last_case <- true$total[length(true$total)]
## Hawkes Projections Dataset
hproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/hawkes_post_proj.csv") #forecasted values
hproj <- hproj %>% select(date_last_case, pred.7, pred.14, pred.21)
hproj$date_last_case <- mdy(hproj$date_last_case)
hdates <- as.character(hproj$date_last_case)
hpreds <- t(hproj %>% select(pred.7,pred.14,pred.21))
## Recursive Projections Dataset
rproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/recursive_post_proj.csv") #forecasted values
rproj <- rproj %>% select(date_last_case, pred.7, pred.14, pred.21)
rproj$date_last_case <- mdy(rproj$date_last_case)
rproj <- na.omit(rproj) # some dates have no projections
rdates <- as.character(rproj$date_last_case)
rpreds <- t(rproj %>% select(pred.7,pred.14,pred.21))
fig <- 1
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 7, res = TRUE, title = title)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 14, res = TRUE)
rmse_h14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 21-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 21, res = TRUE, title = title)
rmse_h21 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 7, res = TRUE, title = title)
rmse_r7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 14, res = TRUE, title = title)
rmse_r14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 21, res = TRUE, title = title)
rmse_r21 <- mod$rmse
mod$plot
caption <- paste0("RMSE values for Hawkes and Recursive Models for all simulations.")
df_rmse <- data.frame(
"Hawkes" = c(rmse_h7, rmse_h14, rmse_h21),
"Recursive" = c(rmse_r7, rmse_r14, rmse_r21)
)
row.names(df_rmse) <- c("7-day","14-day","21-day")
df_rmse %>% kable(digits = 2, caption = caption)
rgx18 <- "2018\\-\\d{1,2}\\-\\d{1,2}" # 2018 date structure regex
rgx19 <- "2019\\-\\d{1,2}\\-\\d{1,2}" # 2019 date structure regex
rgx20 <- "2020\\-\\d{1,2}\\-\\d{1,2}" # 2020 date structure regex
true18 <- true[str_detect(true$date, rgx18),] #thinning down data by year
true19 <- true[str_detect(true$date, rgx19),]
true20 <- true[str_detect(true$date, rgx20),]
nums <- c(nrow(true18),nrow(true19),nrow(true20))
names(nums) <- c("2018","2019","2020")
nums
sum(nrow(true18),nrow(true19),nrow(true20))==nrow(true)
hproj18 <- hproj[str_detect(hproj$date_last_case, rgx18),] #should be 92
hproj19 <- hproj[str_detect(hproj$date_last_case, rgx19),]
hproj20 <- hproj[str_detect(hproj$date_last_case, rgx20),]
nums <- c(nrow(hproj18),nrow(hproj19),nrow(hproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(hproj18),nrow(hproj19),nrow(hproj20)) == nrow(hproj)
rproj18 <- rproj[str_detect(rproj$date_last_case, rgx18),] #should be 92
rproj19 <- rproj[str_detect(rproj$date_last_case, rgx19),]
rproj20 <- rproj[str_detect(rproj$date_last_case, rgx20),]
nums <- c(nrow(rproj18),nrow(rproj19),nrow(rproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(rproj18),nrow(rproj19),nrow(rproj20)) == nrow(rproj)
pro <- function(d) {round(d*12/365, 1)} #apportions days to months
pro(c(nrow(true18),nrow(true19),nrow(true20)))
hproj
mod
rproj
mod
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 7, res = TRUE, title = title)
rmse_r7 <- mod$rmse
mod$plot
mod
rproj
rows19 <- c(105,120,130,136,142,146,150,157,160,161,162,164,165,167,170)
length(rows19)
hproj
rproj
hproj
knitr::opts_chunk$set(echo = FALSE)
## Complete Outbreak Dataset
## Used to plot the true number of infections over time
rm(list=ls())
true <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/15UGkfREtfqH3LdfHmCsSpFJ5SrTnSeyt/ebola/2020-05-04_ebola/2020-05-04_data.csv")
source("outbreak_vis.R") #script with functions
rgx <- "\\d{1,2}\\/\\d{1,2}\\/\\d{4}" #date structure regex
true <- true[str_detect(true$Date, rgx),] #omits rows without a date
colnames(true) <- c("date", "cases")
true$date <- mdy(true$date) #converts into a consistent date format
true$cases[is.na(true$cases)] <- 0
true <- true %>% mutate(total = cumsum(cases))
last_date <- true$date[length(true$date)]
last_case <- true$total[length(true$total)]
## Hawkes Projections Dataset
hproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/hawkes_post_proj.csv") #forecasted values
hproj <- hproj %>% select(date_last_case, pred.7, pred.14, pred.21) #selecting only the cols with forecasts
hproj$date_last_case <- mdy(hproj$date_last_case)
hdates <- as.character(hproj$date_last_case) #for working with dates
hpreds <- t(hproj %>% select(pred.7,pred.14,pred.21)) #take t() for the function
rownames(hproj) <- 1:nrow(hproj)
## Recursive Projections Dataset
rproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/recursive_post_proj.csv") #forecasted values
rproj <- rproj %>% select(date_last_case, pred.7, pred.14, pred.21)
rproj$date_last_case <- mdy(rproj$date_last_case)
rproj <- na.omit(rproj) # some dates have no projections
rdates <- as.character(rproj$date_last_case)
rpreds <- t(rproj %>% select(pred.7,pred.14,pred.21))
fig <- 1 # for numbering the figures in the plots
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 7, res = TRUE, title = title)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 14, res = TRUE)
rmse_h14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 21-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 21, res = TRUE, title = title)
rmse_h21 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 7, res = TRUE, title = title)
rmse_r7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 14, res = TRUE, title = title)
rmse_r14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 21, res = TRUE, title = title)
rmse_r21 <- mod$rmse
mod$plot
caption <- paste0("RMSE values for Hawkes and Recursive Models for all simulations.")
df_rmse <- data.frame(
"Hawkes" = c(rmse_h7, rmse_h14, rmse_h21),
"Recursive" = c(rmse_r7, rmse_r14, rmse_r21)
)
row.names(df_rmse) <- c("7-day","14-day","21-day")
df_rmse %>% kable(digits = 2, caption = caption) #creates a tabble with RMSE values
rgx18 <- "2018\\-\\d{1,2}\\-\\d{1,2}" # 2018 date structure regex
rgx19 <- "2019\\-\\d{1,2}\\-\\d{1,2}" # 2019 date structure regex
rgx20 <- "2020\\-\\d{1,2}\\-\\d{1,2}" # 2020 date structure regex
true18 <- true[str_detect(true$date, rgx18),] #thinning down data by year
true19 <- true[str_detect(true$date, rgx19),]
true20 <- true[str_detect(true$date, rgx20),]
nums <- c(nrow(true18),nrow(true19),nrow(true20))
names(nums) <- c("2018","2019","2020")
nums
sum(nrow(true18),nrow(true19),nrow(true20))==nrow(true)
hproj18 <- hproj[str_detect(hproj$date_last_case, rgx18),] #should be 92
hproj19 <- hproj[str_detect(hproj$date_last_case, rgx19),]
hproj20 <- hproj[str_detect(hproj$date_last_case, rgx20),]
nums <- c(nrow(hproj18),nrow(hproj19),nrow(hproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(hproj18),nrow(hproj19),nrow(hproj20)) == nrow(hproj) #making sure I did it correctly
rproj18 <- rproj[str_detect(rproj$date_last_case, rgx18),] #should be 92
rproj19 <- rproj[str_detect(rproj$date_last_case, rgx19),]
rproj20 <- rproj[str_detect(rproj$date_last_case, rgx20),]
nums <- c(nrow(rproj18),nrow(rproj19),nrow(rproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(rproj18),nrow(rproj19),nrow(rproj20)) == nrow(rproj)
pro <- function(d) {round(d*12/365, 1)} #apportions days to months
pro(c(nrow(true18),nrow(true19),nrow(true20)))
hproj
rows18h <- c(1,3,)
hproj
rproj
rows18h <- c(1,3,16,24,37,54,63,73,81,92)
rows18r <- c(1,3,16,24,37,54,63,73,81,92)
hproj
rproj
hprojrproj
hproj
rproj
hproj
rproj
hproj
rproj
knitr::opts_chunk$set(echo = FALSE)
## Complete Outbreak Dataset
## Used to plot the true number of infections over time
rm(list=ls())
true <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/15UGkfREtfqH3LdfHmCsSpFJ5SrTnSeyt/ebola/2020-05-04_ebola/2020-05-04_data.csv")
source("outbreak_vis.R") #script with functions
rgx <- "\\d{1,2}\\/\\d{1,2}\\/\\d{4}" #date structure regex
true <- true[str_detect(true$Date, rgx),] #omits rows without a date
colnames(true) <- c("date", "cases")
true$date <- mdy(true$date) #converts into a consistent date format
true$cases[is.na(true$cases)] <- 0
true <- true %>% mutate(total = cumsum(cases))
last_date <- true$date[length(true$date)]
last_case <- true$total[length(true$total)]
## Hawkes Projections Dataset
hproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/hawkes_post_proj.csv") #forecasted values
hproj <- hproj %>% select(date_last_case, pred.7, pred.14, pred.21) #selecting only the cols with forecasts
hproj$date_last_case <- mdy(hproj$date_last_case)
hdates <- as.character(hproj$date_last_case) #for working with dates
hpreds <- t(hproj %>% select(pred.7,pred.14,pred.21)) #take t() for the function
rownames(hproj) <- 1:nrow(hproj)
## Recursive Projections Dataset
rproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/recursive_post_proj.csv") #forecasted values
rproj <- rproj %>% select(date_last_case, pred.7, pred.14, pred.21)
rproj$date_last_case <- mdy(rproj$date_last_case)
rproj <- na.omit(rproj) # some dates have no projections
rdates <- as.character(rproj$date_last_case)
rpreds <- t(rproj %>% select(pred.7,pred.14,pred.21))
fig <- 1 # for numbering the figures in the plots
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 7, res = TRUE, title = title)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 14, res = TRUE)
rmse_h14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 21-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 21, res = TRUE, title = title)
rmse_h21 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 7, res = TRUE, title = title)
rmse_r7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 14, res = TRUE, title = title)
rmse_r14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 21, res = TRUE, title = title)
rmse_r21 <- mod$rmse
mod$plot
caption <- paste0("RMSE values for Hawkes and Recursive Models for all simulations.")
df_rmse <- data.frame(
"Hawkes" = c(rmse_h7, rmse_h14, rmse_h21),
"Recursive" = c(rmse_r7, rmse_r14, rmse_r21)
)
row.names(df_rmse) <- c("7-day","14-day","21-day")
df_rmse %>% kable(digits = 2, caption = caption) #creates a tabble with RMSE values
rgx18 <- "2018\\-\\d{1,2}\\-\\d{1,2}" # 2018 date structure regex
rgx19 <- "2019\\-\\d{1,2}\\-\\d{1,2}" # 2019 date structure regex
rgx20 <- "2020\\-\\d{1,2}\\-\\d{1,2}" # 2020 date structure regex
true18 <- true[str_detect(true$date, rgx18),] #thinning down data by year
true19 <- true[str_detect(true$date, rgx19),]
true20 <- true[str_detect(true$date, rgx20),]
nums <- c(nrow(true18),nrow(true19),nrow(true20))
names(nums) <- c("2018","2019","2020")
nums
sum(nrow(true18),nrow(true19),nrow(true20))==nrow(true)
hproj18 <- hproj[str_detect(hproj$date_last_case, rgx18),] #should be 92
hproj19 <- hproj[str_detect(hproj$date_last_case, rgx19),]
hproj20 <- hproj[str_detect(hproj$date_last_case, rgx20),]
nums <- c(nrow(hproj18),nrow(hproj19),nrow(hproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(hproj18),nrow(hproj19),nrow(hproj20)) == nrow(hproj) #making sure I did it correctly
rproj18 <- rproj[str_detect(rproj$date_last_case, rgx18),] #should be 92
rproj19 <- rproj[str_detect(rproj$date_last_case, rgx19),]
rproj20 <- rproj[str_detect(rproj$date_last_case, rgx20),]
nums <- c(nrow(rproj18),nrow(rproj19),nrow(rproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(rproj18),nrow(rproj19),nrow(rproj20)) == nrow(rproj)
pro <- function(d) {round(d*12/365, 1)} #apportions days to months
pro(c(nrow(true18),nrow(true19),nrow(true20)))
rows18h <- c(1,3,16,24,37,54,63,73,81,92)
rows18r <- c(1,3,15,21,33,45,51,59,66,77)
rows19h <- c(105,120,130,136,142,146,150,153,157,160,161,162,164,165,167,170)
rows19r <- c(90,105,115,121,127,131,135,142,145,146,147,149,150,152,155)
rows20h <- c(171,174,176,178,179)
rows20r <- c(156,159,161,163,164)
allr <- c(rows18, rows19, rows20) #combining all rows mentioned above
rows20h <- c(171,174,176,178,179)
rows20r <- c(156,159,161,163,164)
allh <- c(rows18h, rows19h, rows20h) #combining all rows mentioned above
allr <- c(rows18r, rows19r, rows20r)
ref_hawkes <- hproj[rows20h,]
ref_hawkes
ref_hawkes <- hproj[allh,]
ref_rec <- rproj[allr,]
ref_hawkes
ref_hawkes <- hproj[allh,]
hdates_ref <- as.Date(ref_hawkes$date_last_case)
hpreds_ref <- t(ref_hawkes %>% select(pred.7,pred.14,pred.21))
hpreds_ref
hdates_ref
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = FALSE)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = FALSE)
rmse_h7 <- mod$rmse
mod
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE)
rmse_h7 <- mod$rmse
mod
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE, refined = TRUE)
rmse_h7 <- mod$rmse
mod
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE, refined = TRUE)
rmse_h7 <- mod$rmse
mod
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE, title = title, refined = TRUE)
rmse_h7 <- mod$rmse
mod
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE, title = title, refined = TRUE)
rmse_h7 <- mod$rmse
mod$plot
ref_rec <- rproj[allr,]
rdates_ref <- as.Date(ref_rec$date_last_case)
rpreds_ref <- t(ref_rec %>% select(pred.7,pred.14,pred.21))
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
source('~/Desktop/Git/Ebola-Forecasting/Post Outbreak/outbreak_vis.R')
knitr::opts_chunk$set(echo = FALSE)
## Complete Outbreak Dataset
## Used to plot the true number of infections over time
rm(list=ls())
true <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/15UGkfREtfqH3LdfHmCsSpFJ5SrTnSeyt/ebola/2020-05-04_ebola/2020-05-04_data.csv")
source("outbreak_vis.R") #script with functions
rgx <- "\\d{1,2}\\/\\d{1,2}\\/\\d{4}" #date structure regex
true <- true[str_detect(true$Date, rgx),] #omits rows without a date
colnames(true) <- c("date", "cases")
true$date <- mdy(true$date) #converts into a consistent date format
true$cases[is.na(true$cases)] <- 0
true <- true %>% mutate(total = cumsum(cases))
last_date <- true$date[length(true$date)]
last_case <- true$total[length(true$total)]
## Hawkes Projections Dataset
hproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/hawkes_post_proj.csv") #forecasted values
hproj <- hproj %>% select(date_last_case, pred.7, pred.14, pred.21) #selecting only the cols with forecasts
hproj$date_last_case <- mdy(hproj$date_last_case)
hdates <- as.character(hproj$date_last_case) #for working with dates
hpreds <- t(hproj %>% select(pred.7,pred.14,pred.21)) #take t() for the function
rownames(hproj) <- 1:nrow(hproj)
## Recursive Projections Dataset
rproj <- read.csv("/Volumes/GoogleDrive/.shortcut-targets-by-id/1LaD1nL_OAOposW2fr2XDcs6BLHVBC-jA/2019 Ebola/Post-Outbreak Analysis/recursive_post_proj.csv") #forecasted values
rproj <- rproj %>% select(date_last_case, pred.7, pred.14, pred.21)
rproj$date_last_case <- mdy(rproj$date_last_case)
rproj <- na.omit(rproj) # some dates have no projections
rdates <- as.character(rproj$date_last_case)
rpreds <- t(rproj %>% select(pred.7,pred.14,pred.21))
fig <- 1 # for numbering the figures in the plots
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 7,  title = title, res = TRUE)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 14, title = title, res = TRUE)
rmse_h14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 21-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(hdates, hpreds, days = 21,  title = title, res = TRUE)
rmse_h21 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 7, title = title, res = TRUE)
rmse_r7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 14-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 14, title = title, res = TRUE)
rmse_r14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for All Simulations")
fig <- fig + 1
mod <- single_forecast(rdates, rpreds, days = 21, title = title, res = TRUE)
rmse_r21 <- mod$rmse
mod$plot
caption <- paste0("RMSE values for Hawkes and Recursive Models for all simulations.")
df_rmse <- data.frame(
"Hawkes" = c(rmse_h7, rmse_h14, rmse_h21),
"Recursive" = c(rmse_r7, rmse_r14, rmse_r21)
)
row.names(df_rmse) <- c("7-day","14-day","21-day")
df_rmse %>% kable(digits = 2, caption = caption) #creates a tabble with RMSE values
rgx18 <- "2018\\-\\d{1,2}\\-\\d{1,2}" # 2018 date structure regex
rgx19 <- "2019\\-\\d{1,2}\\-\\d{1,2}" # 2019 date structure regex
rgx20 <- "2020\\-\\d{1,2}\\-\\d{1,2}" # 2020 date structure regex
true18 <- true[str_detect(true$date, rgx18),] #thinning down data by year
true19 <- true[str_detect(true$date, rgx19),]
true20 <- true[str_detect(true$date, rgx20),]
nums <- c(nrow(true18),nrow(true19),nrow(true20))
names(nums) <- c("2018","2019","2020")
nums
sum(nrow(true18),nrow(true19),nrow(true20))==nrow(true)
hproj18 <- hproj[str_detect(hproj$date_last_case, rgx18),] #should be 92
hproj19 <- hproj[str_detect(hproj$date_last_case, rgx19),]
hproj20 <- hproj[str_detect(hproj$date_last_case, rgx20),]
nums <- c(nrow(hproj18),nrow(hproj19),nrow(hproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(hproj18),nrow(hproj19),nrow(hproj20)) == nrow(hproj) #making sure I did it correctly
rproj18 <- rproj[str_detect(rproj$date_last_case, rgx18),] #should be 92
rproj19 <- rproj[str_detect(rproj$date_last_case, rgx19),]
rproj20 <- rproj[str_detect(rproj$date_last_case, rgx20),]
nums <- c(nrow(rproj18),nrow(rproj19),nrow(rproj20))
names(nums) <- c("2018","2019","2020")
nums #number of forecasts in that year
sum(nrow(rproj18),nrow(rproj19),nrow(rproj20)) == nrow(rproj)
pro <- function(d) {round(d*12/365, 1)} #apportions days to months
pro(c(nrow(true18),nrow(true19),nrow(true20)))
rows18h <- c(1,3,16,24,37,54,63,73,81,92)
rows18r <- c(1,3,15,21,33,45,51,59,66,77)
rows19h <- c(105,120,130,136,142,146,150,153,157,160,161,162,164,165,167,170)
rows19r <- c(90,105,115,121,127,131,135,142,145,146,147,149,150,152,155)
rows20h <- c(171,174,176,178,179)
rows20r <- c(156,159,161,163,164)
allh <- c(rows18h, rows19h, rows20h) #combining all rows mentioned above
allr <- c(rows18r, rows19r, rows20r)
ref_hawkes <- hproj[allh,]
hdates_ref <- as.Date(ref_hawkes$date_last_case)
hpreds_ref <- t(ref_hawkes %>% select(pred.7,pred.14,pred.21))
title <- paste0("Figure ",fig,": Hawkes 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 7, res = TRUE, title = title, refined = TRUE)
rmse_h7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 14-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 14, res = TRUE, title = title, refined = TRUE)
rmse_h14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Hawkes 21-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(hdates_ref, hpreds_ref, days = 21, res = TRUE, title = title, refined = TRUE)
rmse_h21 <- mod$rmse
mod$plot
ref_rec <- rproj[allr,]
rdates_ref <- as.Date(ref_rec$date_last_case)
rpreds_ref <- t(ref_rec %>% select(pred.7,pred.14,pred.21))
title <- paste0("Figure ",fig,": Recursive 7-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(rdates_ref, rpreds_ref, days = 7, res = TRUE, title = title, refined = TRUE)
rmse_r7 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 14-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(rdates_ref, rpreds_ref, days = 14, res = TRUE, title = title, refined = TRUE)
rmse_r14 <- mod$rmse
mod$plot
title <- paste0("Figure ",fig,": Recursive 21-Day Forecasts for Select Simulations")
fig <- fig + 1
mod <- single_forecast(rdates_ref, rpreds_ref, days = 21, res = TRUE, title = title, refined = TRUE)
rmse_r21 <- mod$rmse
mod$plot
caption <- paste0("RMSE values for Hawkes and Recursive Models for select simulations.")
df_rmse <- data.frame(
"Hawkes" = c(rmse_h7, rmse_h14, rmse_h21),
"Recursive" = c(rmse_r7, rmse_r14, rmse_r21)
)
row.names(df_rmse) <- c("7-day","14-day","21-day")
df_rmse %>% kable(digits = 2, caption = caption) #creates a tabble with RMSE values
